package at.fhjoanneum.ims.vulnerability.service;

import lombok.extern.slf4j.Slf4j;
import org.springframework.http.ResponseEntity;
import org.springframework.stereotype.Service;

import java.io.*;

@Service
@Slf4j
public class CommandService {

    public String execCommand(String input) {
        StringBuilder sb = new StringBuilder();
        try {
            Process process;
            process = Runtime.getRuntime().exec("bash -c " + input);
            int result = process.waitFor();
            BufferedReader stdInput;

            if (result != 0) {
                log.info("error occurred");
                stdInput = new BufferedReader(new InputStreamReader(process.getErrorStream()));
            } else {
                stdInput = new BufferedReader(new InputStreamReader(process.getInputStream()));
            }

            String s;
            while ((s = stdInput.readLine()) != null) {
                sb.append(s);
            }
        } catch (IOException e) {
            throw new RuntimeException(e);
        } catch (InterruptedException e) {
            throw new RuntimeException(e);
        }
        return sb.toString();
    }

    // path traversal
    public String readFile(String name) {
        if(name == null)
            throw new IllegalArgumentException();

        File file = new File("./", name);

        try(BufferedReader in = new BufferedReader(new FileReader(file)))
        {
            StringBuilder buffer = new StringBuilder();
            String line;
            while ((line = in.readLine()) != null)
            {
                buffer.append(line).append("\n");
            }
            return buffer.toString();
        }
        catch (IOException e)
        {
            throw new IllegalStateException("Can't access file " + name, e);
        }
    }
}
